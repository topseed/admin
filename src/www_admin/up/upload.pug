script(src='//cdn.jsdelivr.net/npm/dropzone@5.4.0/dist/min/dropzone.min.js')
script.
		Dropzone.autoDiscover = false

p
.ui

	form#upload1Cont.ui.form.dropzone(action='/upload')
		h4.ui.dividing.header Upload
		.field
			label Secret
			input(type='text', name='secret', placeholder='123')

		.field
			label Target folder
			input(type='text', name='folder', placeholder='item/one')

		p
		br
		p (Drag and ) Drop files here to upload.


script.
	loadjs([
		'//cdn.jsdelivr.net/npm/dropzone@5.4.0/dist/min/dropzone.min.css'
		//, '//cdn.jsdelivr.net/npm/riot@3.9.1/riot.js'
	], 'dz' /* bundle ID */, {
		async: false //required due to loadjs bug with bundles
	})

	loadjs.ready(['site','dz'], function () {
		setupDZ()
	})//ready

	function setupDZ() {

		let myDropzone = new Dropzone('#upload1Cont', {
				url: '/upload',
				uploadMultiple: false
			})
		const secretProp = 'secret'
		const folderProp = 'folder'

		myDropzone.on('sending', function(file, xhr, formData) {
			console.log('sending')

			let sec = $('#upload1Cont [name="secret"]').val()
			let folder = $('#upload1Cont [name="folder"]').val()
			console.log(sec,folder)
			formData.append(secretProp, sec)
			formData.append(folderProp, folder)
		})

		myDropzone.on('success', function(file, resp) {
			console.log(file, resp)
		})

		myDropzone.on('canceled', function(file) {
			console.log(file)
			myDropzone.removeFile(file)
		})

		myDropzone.on('error', function(file, error) {
			console.log(file, error)
		})

		function clearAll() {
			myDropzone.files

		}

	}//()
